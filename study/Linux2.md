# Linux

## Linuxのディレクトリ構造

https://qiita.com/nys9302/items/a8ddeedd3cd9d0deb332



## ユーザ/グループ管理

Linuxのユーザとグループの概念は、システムのセキュリティやリソース管理の根幹となる仕組みです。

グループとユーザを適切に設定することで、ファイルやディレクトリ、
任意のプログラムやシェルスクリプトなどを必要なユーザにのみ参照・編集する権限や実行する権限を与えることができます。

最小権限の原則に従い、必要な権限だけを与えることで、セキュリティを高めることができます。

用意されているユーザとグループは以下の通りです。

rootユーザ
利用に制限がない特別なユーザ。全ての操作を行うことができるため、厳格に管理する必要があります。


**ユーザ**
権限を定義できる最小単位

ユーザの定義は/etc/passwdファイルに記述されていますが、 /etc/passwdファイルを直接編集はせず、
コマンドを使ってユーザを追加・削除することが推奨されています。
/etc/passwdファイルのフォーマット：ユーザ名:パスワード:ユーザID:グループID:ユーザ情報:ホームディレクトリ:ログインシェル
例：root:x:0:0:root:/root:/bin/bash
※ grepコマンドでユーザを検索することができます
※ ほとんどのディストリビューションではパスワードは/etc/shadowファイルに記述されています

- useradd: ユーザを追加
    - useradd -g groupname: グループを指定 ※ /etc/groupファイルに記述されているグループ名を指定
    - useradd -s /bin/bash: ログインシェルを指定 ※ ログインしないユーザはnologinを指定するなどします
    - useraddd -u 1000: ユーザIDを指定
- usermod: ユーザの属性を変更
    - usermod -g groupname: グループを変更 ※ /etc/groupファイルに記述されているグループ名を指定
    - usermod -l newname: ユーザ名を変更
    - usermod -u 1000: ユーザIDを変更
- userdel: ユーザを削除
    - userdel -r: ユーザのホームディレクトリも削除

ユーザの確認：`cat /etc/passwd`


**グループ**
複数のユーザをまとめて管理するための仕組み
ユーザは必ず1つ以上のグループに所属していて、主に所属するグループをプライマリグループと呼びます

グループの定義は/etc/groupファイルに記述されていますが、 /etc/groupファイルを直接編集はせず、
コマンドを使ってグループを追加・削除することが推奨されています。
/etc/groupファイルのフォーマット：グループ名:パスワード:グループID:所属ユーザリスト
例：root:x:0:root

- groupadd: グループを追加
    - groupadd -g 1000: グループIDを指定
- groupmod: グループの属性を変更
    - groupmod -g 1000: グループIDを変更
    - groupmod -n newname: グループ名を変更
- groupdel: グループを削除

グループの確認：`cat /etc/group`


**操作**

- su: ユーザを切り替える
    - su root: rootユーザに切り替え
    - su -: rootユーザに切り替え。カレントディレクトリも変更
    - su - user: userユーザに切り替え。カレントディレクトリも変更
- sudo: root権限でコマンドを実行
    - sudo command: commandをroot権限で実行
    - sudo -u user command: user権限でcommandを実行
      ※ sudo の設定は/etc/sudoers ファイルを編集することでユーザが sudo コマンドを利用できるよう
      になります。/etc/sudoers ファイルは visudo コマンドを実行すると編集できます


## パーミッション

Linuxのファイルやディレクトリには、読み取り、書き込み、実行の権限があり、
所有するユーザ、グループ(所有ユーザを除いたグループ内のユーザ)、その他のユーザに対してそれぞれ設定することができます。
これらの権限を設定することで、ファイルやディレクトリのアクセスを制御することができます。


- chown: ファイルやディレクトリの所有者を変更
    - chown user file: fileの所有者をuserに変更
    - chown user:group file: fileの所有者をuser、グループをgroupに変更
    - chown -R user:group dir: dir以下のファイルやディレクトリの所有者を再帰的に変更
- chgrp: ファイルやディレクトリのグループを変更
    - chgrp group file: fileのグループをgroupに変更
    - chgrp -R group dir: dir以下のファイルやディレクトリのグループを再帰的に変更

**パーミッションの設定**

ls -l で表示されるパーミッションは以下のようになっています。
例：-rwxr-xr--
先頭がファイルの種類を表し、それ以降3つずつが所有者、グループ、その他のユーザの権限を表します。

ファイルの種類
- -: 通常のファイル
- d: ディレクトリ
- l: シンボリックリンク

権限
- r: 読み取り
- w: 書き込み
- x: 実行

パーミッションの数値表現
- r: 4
- w: 2
- x: 1

例： 7(4+2+1): rwx

- chmod: ファイルやディレクトリのパーミッションを変更
    - chmod 777 file: fileのパーミッションをrwxrwxrwxに変更
    - chmod 755 file: fileのパーミッションをrwxr-xr-xに変更
    - chmod u+x file: fileの所有者に実行権限を付与
    - chmod g-w file: fileのグループから書き込み権限を削除
    - chmod o-r file: fileのその他のユーザから読み取り権限を削除
    - chmod -R 777 dir: dir以下のファイルやディレクトリのパーミッションを再帰的に変更
    - chmod u=rwx,go=rx file: fileの所有者にrwx、グループとその他のユーザにrxの権限を付与
    - chmod u=rw,go=r file: fileの所有者にrw、グループとその他のユーザにrの権限を付与

- umask: ファイルのパーミッションをデフォルトで設定。パーミッション666からumaskの値を引いたものがデフォルトのパーミッションになります
    - umask 022: ファイルのパーミッションをrw-r--r--に設定

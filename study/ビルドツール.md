# ビルドツール

※研修ではGradle(グレイドル)を使用しているため、Gradleの説明となります。  Maven(メイヴン)も大きくは変わりません

ビルドツールは、ソースコードを実行可能な形式に変換するためのツールです。Javaでは、JARファイルやWARファイルなどの形式で出力されます。

また、依存関係の管理や、タスクの作成、実行なども行えます

## 依存関係の管理
SpringBootプロジェクトではbuild.gradleファイルに依存関係を記述します。
```groovy
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
	testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

依存関係の保持スコープ表
| スコープ | プロダクションコードのコンパイル | プロダクションコードの実行 | テストコードのコンパイル | テストコードの実行 |
| --- | --- | --- | --- | --- |
| implementation | ○ | ○ | ○ | ○ |
| compileOnly | ○ | × | ○ | × |
| annotationProcessor | ○ | × | ○ | × |
| runtimeOnly | × | ○ | × | ○ |
| testImplementation | × | × | ○ | ○ |
| testCompileOnly | × | × | ○ | × |
| testRuntimeOnly | × | × | × | ○ |

一般的にはバージョンの記載が必要ですが、SpringBootではバージョンを記載しなくても、SpringBootのバージョンに合わせて自動的に依存関係が解決されます。  
※ dependency-managementプラグインを使用しているため(build.gradleのpluginsセクションに記載されている)


## タスクの作成
Gradleでは、タスクを定義することができます。  
SpringBootの場合は、build.gradleのpluginsセクションに記載されているspringbootプラグインによって、タスクが自動生成され、アプリケーションのビルドや実行、テストのためのタスクが利用できます。

よく使うタスクは以下の通りです。

| タスク名 | 説明 |
| --- | --- |
| bootRun | アプリケーションを実行する |
| bootJar | アプリケーションをJARファイルにビルドする(実行jarを作成) |
| clean | ビルド成果物を削除する(buildディレクトリを削除) |
| build | アプリケーションをビルドする(コンパイル、テスト、jarの作成など) |
| test | テストを実行する |
| javadoc | Javadocを生成する |

カスタムタスク
```groovy
task hello {
    doLast {
        println 'Hello, World!'
    }
}

// 現場ではテストタスクをカスタマイズして追加したり、アプリケーションの実行に鍵が必要な場合に鍵をダウンロードするタスクを追加したりします
task localIntegration (type: Test) {
	useJUnitPlatform()
	systemProperty("integration.url", "http://localhost:8080")
	include("/com/compass/javaapisamp/integration/**")
}
```

## タスクの実行
gradlew(Gradle Wrapper)コマンドがSpringBootプロジェクトでは用意されています  
※プロジェクトに含まれているgradlew (UNIX系), gradlew.bat (Windows)

gradle/wrapper/gradle-wrapper.propertiesに記載されているGradleのバージョンを利用
gradle/wrapper/gradle-wrapper.jarがgradleをダウンロードするためのjarファイル

```
./gradlew <タスク名>
```
